<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> å¹¶å‘ç¼–ç¨‹(ä¸‹) | self-salvation</title>
  <link rel = 'canonical' href = 'https://jinkes-li.github.io/python/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%8B/'>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="å¹¶å‘ç¼–ç¨‹(ä¸‹)" />
<meta property="og:description" content="å¤šè¿›ç¨‹å®ç°TCPæœåŠ¡ç«¯å¹¶å‘ # å¯¼å…¥socket import socket from multiprocessing import Process # ç”¨äºåˆ›å»ºè¿›ç¨‹çš„æ¨¡å— # åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ï¼Œç”±äºéœ€è¦å®ç°å¹¶å‘ï¼Œéœ€è¦ä½¿ç”¨å‡½æ•°åŒ…èµ·æ¥ä¾›è°ƒç”¨ def get_server(): # åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ server = socket.socket() # ç»‘å®šæœåŠ¡ç«¯å¯¹å¤–çš„åœ°å€å’Œæ¥å£ server.bind((&#39;127.0.0.1&#39;, 8080)) # è®¾ç½®åŠè¿æ¥æ±  server.listen(5) # è¿”å›åˆ›å»ºçš„å¯¹è±¡ä¾›è°ƒç”¨ return server # å®šä¹‰ä¸€ä¸ªç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥çš„å‡½æ•° def get_talk(sock): # éœ€è¦å¾ªç¯æ¥æ”¶ä¿¡æ¯ while True: # å®šä¹‰æ¥æ”¶çš„ä¿¡æ¯ä»¥åŠéœ€è¦å¤„ç†çš„æ“ä½œ data = sock.recv(1024) print(data.decode(&#39;utf8&#39;)) # å°†æ¥æ”¶åˆ°çš„ä¿¡æ¯è½¬ä¸ºå¤§å†™ sock.send(data.upper()) # åˆ¤æ–­æ˜¯å¦ä¸ºæ‰§è¡Œæ–‡ä»¶ï¼Œä¸»è¦ä½œä¸ºå…¼å®¹win if __name__ == &#39;__main__&#39;: # è·å–æœåŠ¡ç«¯ä¿¡æ¯ server = get_server() # å¾ªç¯å¼€è®¾è¿›ç¨‹ while True: # ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ sock, addr = server.accept() # å¼€è®¾è¿›ç¨‹èŠå¤© p = Process(target=get_talk, args=(sock,)) # å¯åŠ¨è¿›ç¨‹ p." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jinkes-li.github.io/python/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%8B/" /><meta property="article:section" content="python" />
<meta property="article:published_time" content="2022-11-21T22:42:59+08:00" />
<meta property="article:modified_time" content="2022-11-21T22:42:59+08:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="å¹¶å‘ç¼–ç¨‹(ä¸‹)"/>
<meta name="twitter:description" content="å¤šè¿›ç¨‹å®ç°TCPæœåŠ¡ç«¯å¹¶å‘ # å¯¼å…¥socket import socket from multiprocessing import Process # ç”¨äºåˆ›å»ºè¿›ç¨‹çš„æ¨¡å— # åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ï¼Œç”±äºéœ€è¦å®ç°å¹¶å‘ï¼Œéœ€è¦ä½¿ç”¨å‡½æ•°åŒ…èµ·æ¥ä¾›è°ƒç”¨ def get_server(): # åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ server = socket.socket() # ç»‘å®šæœåŠ¡ç«¯å¯¹å¤–çš„åœ°å€å’Œæ¥å£ server.bind((&#39;127.0.0.1&#39;, 8080)) # è®¾ç½®åŠè¿æ¥æ±  server.listen(5) # è¿”å›åˆ›å»ºçš„å¯¹è±¡ä¾›è°ƒç”¨ return server # å®šä¹‰ä¸€ä¸ªç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥çš„å‡½æ•° def get_talk(sock): # éœ€è¦å¾ªç¯æ¥æ”¶ä¿¡æ¯ while True: # å®šä¹‰æ¥æ”¶çš„ä¿¡æ¯ä»¥åŠéœ€è¦å¤„ç†çš„æ“ä½œ data = sock.recv(1024) print(data.decode(&#39;utf8&#39;)) # å°†æ¥æ”¶åˆ°çš„ä¿¡æ¯è½¬ä¸ºå¤§å†™ sock.send(data.upper()) # åˆ¤æ–­æ˜¯å¦ä¸ºæ‰§è¡Œæ–‡ä»¶ï¼Œä¸»è¦ä½œä¸ºå…¼å®¹win if __name__ == &#39;__main__&#39;: # è·å–æœåŠ¡ç«¯ä¿¡æ¯ server = get_server() # å¾ªç¯å¼€è®¾è¿›ç¨‹ while True: # ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ sock, addr = server.accept() # å¼€è®¾è¿›ç¨‹èŠå¤© p = Process(target=get_talk, args=(sock,)) # å¯åŠ¨è¿›ç¨‹ p."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://jinkes-li.github.io/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css" integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://jinkes-li.github.io/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://jinkes-li.github.io/">
  
    <div id="logo" style="background-image: url(https://jinkes-li.github.io/images/logo.png)"></div>
  
  <div id="title">
    <h1>self-salvation</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="Menu"><i class="fas fa-bars fa-2x" aria-hidden="true"></i></a>
      </li>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/posts/">All posts</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
        <li><a href="/python">Python</a></li>
      
        <li><a href="/databases">databases</a></li>
      
        <li><a href="/web">web</a></li>
      
        <li><a href="/about">About</a></li>
      
    </ul>
  </div>
</header>



    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <ul>
<li>å¤šè¿›ç¨‹å®ç°TCPæœåŠ¡ç«¯å¹¶å‘</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># å¯¼å…¥socket</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> multiprocessing <span style="color:#f92672">import</span> Process  <span style="color:#75715e"># ç”¨äºåˆ›å»ºè¿›ç¨‹çš„æ¨¡å—</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ï¼Œç”±äºéœ€è¦å®ç°å¹¶å‘ï¼Œéœ€è¦ä½¿ç”¨å‡½æ•°åŒ…èµ·æ¥ä¾›è°ƒç”¨</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_server</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ç»‘å®šæœåŠ¡ç«¯å¯¹å¤–çš„åœ°å€å’Œæ¥å£</span>
</span></span><span style="display:flex;"><span>    server<span style="color:#f92672">.</span>bind((<span style="color:#e6db74">&#39;127.0.0.1&#39;</span>, <span style="color:#ae81ff">8080</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è®¾ç½®åŠè¿æ¥æ± </span>
</span></span><span style="display:flex;"><span>    server<span style="color:#f92672">.</span>listen(<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è¿”å›åˆ›å»ºçš„å¯¹è±¡ä¾›è°ƒç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰ä¸€ä¸ªç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥çš„å‡½æ•°</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_talk</span>(sock):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># éœ€è¦å¾ªç¯æ¥æ”¶ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å®šä¹‰æ¥æ”¶çš„ä¿¡æ¯ä»¥åŠéœ€è¦å¤„ç†çš„æ“ä½œ</span>
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> sock<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>        print(data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf8&#39;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å°†æ¥æ”¶åˆ°çš„ä¿¡æ¯è½¬ä¸ºå¤§å†™</span>
</span></span><span style="display:flex;"><span>        sock<span style="color:#f92672">.</span>send(data<span style="color:#f92672">.</span>upper())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ¤æ–­æ˜¯å¦ä¸ºæ‰§è¡Œæ–‡ä»¶ï¼Œä¸»è¦ä½œä¸ºå…¼å®¹win</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è·å–æœåŠ¡ç«¯ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">=</span> get_server()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å¾ªç¯å¼€è®¾è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚</span>
</span></span><span style="display:flex;"><span>        sock, addr <span style="color:#f92672">=</span> server<span style="color:#f92672">.</span>accept()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å¼€è®¾è¿›ç¨‹èŠå¤©</span>
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> Process(target<span style="color:#f92672">=</span>get_talk, args<span style="color:#f92672">=</span>(sock,))
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å¯åŠ¨è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>        p<span style="color:#f92672">.</span>start()
</span></span></code></pre></div><ul>
<li>äº’æ–¥é”ä»£ç å®æ“</li>
</ul>
<blockquote>
<p>äº’æ–¥é”: å¯¹å…±äº«æ•°æ®è¿›è¡Œé”å®šï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å»æ“ä½œ
äº’æ–¥é”æ˜¯å¤šä¸ªçº¿ç¨‹ä¸€èµ·å»æŠ¢ï¼ŒæŠ¢åˆ°é”çš„çº¿ç¨‹å…ˆæ‰§è¡Œï¼Œæ²¡æœ‰æŠ¢åˆ°é”çš„çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼Œç­‰äº’æ–¥é”ä½¿ç”¨å®Œé‡Šæ”¾åï¼Œå…¶å®ƒç­‰å¾…çš„çº¿ç¨‹å†å»æŠ¢è¿™ä¸ªé”ã€‚æ‰€ä»¥äº’æ–¥é”ä¹Ÿæ˜¯ç‹¬å é”
äº’æ–¥é”ğŸ”ï¼šå»ºè®®åªå¯¹æ“ä½œæ•°æ®çš„éƒ¨åˆ†åŠ é”ï¼Œå¦åˆ™æ•´ä¸ªç¨‹åºæ•ˆç‡ä¼šæä½ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸å½“è¾ƒä¸ºé€ æˆæ­»é”ï¼Œç›¸å…³æ­»é”åœ¨æ¥ä¸‹æ¥ä¹Ÿä¼šä»‹ç»</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># äº’æ–¥é”ä»£ç å®é™…æ“ä½œ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> multiprocessing <span style="color:#f92672">import</span> Process, set_start_method, Lock  <span style="color:#75715e"># å¯ä»¥åœ¨multiprocessingè¿™ä¸ªæ¨¡å—ä¸­ç›´æ¥å¼•ç”¨Lock</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”¨æˆ·æŸ¥çœ‹ç¥¨</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">search</span>(name):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;/Users/wesley/PycharmProjects/pythonProject5/data.json&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">æŸ¥çœ‹ç¥¨ï¼Œç›®å‰å‰©ä½™ï¼š</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (name, data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;ticket_num&#39;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”¨æˆ·è´­ä¹°ç¥¨</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">buy</span>(name):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å…ˆå¯¹ç¥¨æ•°å†æ¬¡æŸ¥è¯¢</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;/Users/wesley/PycharmProjects/pythonProject5/data.json&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span>
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å¼€å§‹ä¹°ç¥¨é€»è¾‘</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;ticket_num&#39;</span>) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;/Users/wesley/PycharmProjects/pythonProject5/data.json&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>            data[<span style="color:#e6db74">&#39;ticket_num&#39;</span>] <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            json<span style="color:#f92672">.</span>dump(data, f)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> ä¹°ç¥¨æˆåŠŸ&#39;</span> <span style="color:#f92672">%</span> name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> ä¹°ç¥¨å¤±è´¥ï¼Œå·²ç»æ²¡æœ‰ç¥¨äº†&#39;</span> <span style="color:#f92672">%</span> name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºå‡½æ•°æ‰§è¡ŒæŸ¥ç¥¨ä¹°ç¥¨é€»è¾‘</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(name, mutex):
</span></span><span style="display:flex;"><span>    search(name)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ¥ä¸‹æ¥éœ€è¦è¿è¡Œè´­ä¹°è½¦ç¥¨çš„å‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è¿›è¡ŒåŠ é”ï¼Œä¿è¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>    mutex<span style="color:#f92672">.</span>acquire()  <span style="color:#75715e"># æ·»åŠ é”</span>
</span></span><span style="display:flex;"><span>    buy(name)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åœ¨ä¸Šé¢çš„å‡½æ•°è¿è¡Œç»“æŸåï¼Œä¸èƒ½å½±å“å…¶ä»–è¿›ç¨‹çš„æ‰§è¡Œï¼Œéœ€è¦ç«‹åˆ»é‡Šæ”¾é”</span>
</span></span><span style="display:flex;"><span>    mutex<span style="color:#f92672">.</span>release()  <span style="color:#75715e"># é‡Šæ”¾é”</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set_start_method(<span style="color:#e6db74">&#39;fork&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># éœ€è¦åœ¨è¿™é‡Œäº§ç”Ÿä¸€æŠŠé”</span>
</span></span><span style="display:flex;"><span>    mutex <span style="color:#f92672">=</span> Lock()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> Process(target<span style="color:#f92672">=</span>run, args<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;ç”¨æˆ·</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">å·&#39;</span> <span style="color:#f92672">%</span> i, mutex))
</span></span><span style="display:flex;"><span>        p<span style="color:#f92672">.</span>start()
</span></span></code></pre></div><ul>
<li>çº¿ç¨‹ç†è®º</li>
</ul>
<blockquote>
<p>çº¿ç¨‹æ˜¯ç¨‹åºä¸­æœ€å°æ‰§è¡Œå•ä½ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹
è¿›ç¨‹æ—¶èµ„æºå•ä½ï¼Œä¸€èˆ¬ä»£è¡¨ä¸€å—å†…å­˜ç©ºé—´
çº¿ç¨‹æ‰æ˜¯æ‰§è¡Œå•ä½ï¼Œæ˜¯çœŸæ­£çš„ä»£ç æŒ‡ä»¤</p>
</blockquote>
<ol>
<li>ä¸€ä¸ªè¿›ç¨‹å†…å¯ä»¥å¼€è®¾å¤šä¸ªçº¿ç¨‹</li>
<li>åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„å¤šä¸ªçº¿ç¨‹çš„æ•°æ®æ˜¯å…±äº«çš„</li>
<li>åˆ›å»ºè¿›ç¨‹çš„æ¶ˆè€—è¦è¿œè¿œå¤§äºåˆ›å»ºçº¿ç¨‹
// å¾…è¡¥å……</li>
</ol>
<ul>
<li>åˆ›å»ºçº¿ç¨‹çš„å¤šç§æ–¹å¼</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ç¬¬ä¸€ç§æ–¹å¼
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºçº¿ç¨‹éœ€è¦ä½¿ç”¨threadingæ¨¡å—</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> Thread
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">task</span>(name):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74"> is running&#39;</span>)
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74"> is over&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>):
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> Thread(target<span style="color:#f92672">=</span>task, args<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;ç”¨æˆ·</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span>i,))
</span></span><span style="display:flex;"><span>        t<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ç¬¬äºŒç§æ–¹å¼
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> Thread
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span>(Thread):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;run is runing&#39;</span>)
</span></span><span style="display:flex;"><span>        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;run is over&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>obj <span style="color:#f92672">=</span> MyThread()
</span></span><span style="display:flex;"><span>obj<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;ä¸»è¿›ç¨‹&#39;</span>)
</span></span></code></pre></div><ul>
<li>çº¿ç¨‹çš„è¯¸å¤šç‰¹æ€§</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ae81ff">1.</span>joinæ–¹æ³•
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2.</span>åŒè¿›ç¨‹å†…å¤šä¸ªçº¿ç¨‹æ•°æ®å…±äº«
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3.</span>current_thread()
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4.</span>active_count()
</span></span><span style="display:flex;"><span>å¾…è¡¥å……
</span></span></code></pre></div><ul>
<li>
<p>å®ˆæŠ¤çº¿ç¨‹
åŒè¿›ç¨‹</p>
</li>
<li>
<p>çº¿ç¨‹è¯¸å¤šæ–¹æ³•
åŒè¿›ç¨‹</p>
</li>
<li>
<p>GILå…¨å±€è§£é‡Šå™¨é”</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># å®˜æ–¹æ–‡æ¡£å¯¹GILçš„è§£é‡Š</span>
</span></span><span style="display:flex;"><span>In CPython, the <span style="color:#66d9ef">global</span> interpreter lock, <span style="color:#f92672">or</span> GIL, <span style="color:#f92672">is</span> a mutex that prevents multiple native threads <span style="color:#f92672">from</span> executing Python bytecodes at once<span style="color:#f92672">.</span> This lock <span style="color:#f92672">is</span> necessary mainly because CPython<span style="color:#960050;background-color:#1e0010">â€™</span>s memory management <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> thread<span style="color:#f92672">-</span>safe<span style="color:#f92672">.</span> (However, since the GIL exists, other features have grown to depend on the guarantees that it enforces<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.</span>åœ¨CPythonè§£é‡Šå™¨ä¸­å­˜åœ¨å…¨å±€è§£é‡Šå™¨é”ç®€ç§°GIL
</span></span><span style="display:flex;"><span>	pythonè§£é‡Šå™¨æœ‰å¾ˆå¤šç±»å‹
</span></span><span style="display:flex;"><span>		CPython JPython PyPython (å¸¸ç”¨çš„æ˜¯CPythonè§£é‡Šå™¨)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2.</span>GILæœ¬è´¨ä¹Ÿæ˜¯ä¸€æŠŠäº’æ–¥é” ç”¨æ¥é˜»æ­¢åŒä¸€ä¸ªè¿›ç¨‹å†…å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ(é‡è¦)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3.</span>GILçš„å­˜åœ¨æ˜¯å› ä¸ºCPythonè§£é‡Šå™¨ä¸­å†…å­˜ç®¡ç†ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„(åƒåœ¾å›æ”¶æœºåˆ¶)
</span></span></code></pre></div><ul>
<li>éªŒè¯GILçš„å­˜åœ¨</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># éªŒè¯GILå­˜åœ¨</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> Thread
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>num <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">task</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> num
</span></span><span style="display:flex;"><span>    num <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>t_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">=</span> Thread(target<span style="color:#f92672">=</span>task)
</span></span><span style="display:flex;"><span>    t<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>    t_list<span style="color:#f92672">.</span>append(t)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> t_list:
</span></span><span style="display:flex;"><span>    t<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>print(num)
</span></span></code></pre></div><ul>
<li>GILä¸æ™®é€šäº’æ–¥é”</li>
</ul>
<blockquote>
<p>GILä¸­ä½¿ç”¨çš„äº’æ–¥é”æ˜¯ä¸ºäº†é˜²æ­¢åƒåœ¾å›æ”¶æœºåˆ¶åœ¨çº¿ç¨‹å¤„ç†æ•°æ®æ—¶å›æ”¶æ­£åœ¨å»ºç«‹çš„æ•°æ®ï¼Œæ¯”å¦‚å˜é‡
æ™®é€šçš„äº’æ–¥é”æ˜¯ä¸ºäº†é˜²æ­¢åœ¨å¤„ç†ä»£ç é€»è¾‘æ—¶å¤šä¸ªçº¿ç¨‹åŸºäºåˆå§‹æ•°æ®å¯¹æ•°æ®è¿›è¡Œå¤„ç†</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> Thread,Lock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>num <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">task</span>(mutex):  <span style="color:#75715e"># è¿™é‡Œéœ€è¦å°†åˆ›å»ºçš„é”ä¼ å…¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> num
</span></span><span style="display:flex;"><span>    mutex<span style="color:#f92672">.</span>acquire()  <span style="color:#75715e"># æŠ¢é”</span>
</span></span><span style="display:flex;"><span>    count <span style="color:#f92672">=</span> num
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>    num <span style="color:#f92672">=</span> count <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    mutex<span style="color:#f92672">.</span>release()  <span style="color:#75715e"># é‡Šæ”¾é”</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mutex <span style="color:#f92672">=</span> Lock()  <span style="color:#75715e"># ä¿è¯æ•°æ®çš„å®‰å…¨æ€§</span>
</span></span><span style="display:flex;"><span>t_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">=</span> Thread(target<span style="color:#f92672">=</span>task,args<span style="color:#f92672">=</span>(mutex,)) <span style="color:#75715e"># ä¼ å…¥åˆ›å»ºçš„é”</span>
</span></span><span style="display:flex;"><span>    t<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>    t_list<span style="color:#f92672">.</span>append(t)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> t_list:
</span></span><span style="display:flex;"><span>    t<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>print(num)
</span></span></code></pre></div><ul>
<li>pythonå¤šçº¿ç¨‹æ˜¯å¦æœ‰ç”¨</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>éœ€è¦åˆ†æƒ…å†µ
</span></span><span style="display:flex;"><span>	æƒ…å†µ1
</span></span><span style="display:flex;"><span>    	å•ä¸ªCPU
</span></span><span style="display:flex;"><span>    	å¤šä¸ªCPU
</span></span><span style="display:flex;"><span>	æƒ…å†µ2
</span></span><span style="display:flex;"><span>    	IOå¯†é›†å‹(ä»£ç æœ‰IOæ“ä½œ)
</span></span><span style="display:flex;"><span>       è®¡ç®—å¯†é›†å‹(ä»£ç æ²¡æœ‰IO)
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.</span>å•ä¸ªCPU
</span></span><span style="display:flex;"><span>	IOå¯†é›†å‹
</span></span><span style="display:flex;"><span>    	å¤šè¿›ç¨‹
</span></span><span style="display:flex;"><span>        ç”³è¯·é¢å¤–çš„ç©ºé—´ æ¶ˆè€—æ›´å¤šçš„èµ„æº
</span></span><span style="display:flex;"><span>		å¤šçº¿ç¨‹
</span></span><span style="display:flex;"><span>        æ¶ˆè€—èµ„æºç›¸å¯¹è¾ƒå°‘ é€šè¿‡å¤šé“æŠ€æœ¯
</span></span><span style="display:flex;"><span>      ps:å¤šçº¿ç¨‹æœ‰ä¼˜åŠ¿<span style="color:#960050;background-color:#1e0010">!!!</span>
</span></span><span style="display:flex;"><span> 	è®¡ç®—å¯†é›†å‹
</span></span><span style="display:flex;"><span>    	å¤šè¿›ç¨‹
</span></span><span style="display:flex;"><span>        ç”³è¯·é¢å¤–çš„ç©ºé—´ æ¶ˆè€—æ›´å¤šçš„èµ„æº(æ€»è€—æ—¶<span style="color:#f92672">+</span>ç”³è¯·ç©ºé—´<span style="color:#f92672">+</span>æ‹·è´ä»£ç <span style="color:#f92672">+</span>åˆ‡æ¢)
</span></span><span style="display:flex;"><span> 		å¤šçº¿ç¨‹
</span></span><span style="display:flex;"><span>        æ¶ˆè€—èµ„æºç›¸å¯¹è¾ƒå°‘ é€šè¿‡å¤šé“æŠ€æœ¯(æ€»è€—æ—¶<span style="color:#f92672">+</span>åˆ‡æ¢)
</span></span><span style="display:flex;"><span>      ps:å¤šçº¿ç¨‹æœ‰ä¼˜åŠ¿<span style="color:#960050;background-color:#1e0010">!!!</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2.</span>å¤šä¸ªCPU
</span></span><span style="display:flex;"><span>	IOå¯†é›†å‹
</span></span><span style="display:flex;"><span>   		å¤šè¿›ç¨‹
</span></span><span style="display:flex;"><span>         æ€»è€—æ—¶(å•ä¸ªè¿›ç¨‹çš„è€—æ—¶<span style="color:#f92672">+</span>IO<span style="color:#f92672">+</span>ç”³è¯·ç©ºé—´<span style="color:#f92672">+</span>æ‹·è´ä»£ç )
</span></span><span style="display:flex;"><span>       å¤šçº¿ç¨‹
</span></span><span style="display:flex;"><span>    	  æ€»è€—æ—¶(å•ä¸ªè¿›ç¨‹çš„è€—æ—¶<span style="color:#f92672">+</span>IO)
</span></span><span style="display:flex;"><span>       ps:å¤šçº¿ç¨‹æœ‰ä¼˜åŠ¿<span style="color:#960050;background-color:#1e0010">!!!</span>
</span></span><span style="display:flex;"><span>	è®¡ç®—å¯†é›†å‹
</span></span><span style="display:flex;"><span>    	å¤šè¿›ç¨‹
</span></span><span style="display:flex;"><span>       	  æ€»è€—æ—¶(å•ä¸ªè¿›ç¨‹çš„è€—æ—¶)
</span></span><span style="display:flex;"><span>    	å¤šçº¿ç¨‹
</span></span><span style="display:flex;"><span>          æ€»è€—æ—¶(å¤šä¸ªè¿›ç¨‹çš„ç»¼åˆ)
</span></span><span style="display:flex;"><span>       ps:å¤šè¿›ç¨‹å®Œèƒœ<span style="color:#960050;background-color:#1e0010">!!!</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> Thread
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> multiprocessing <span style="color:#f92672">import</span> Process
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">work</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è®¡ç®—å¯†é›†å‹</span>
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">100000</span>):
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">*=</span> i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># print(os.cpu_count())  # 12  æŸ¥çœ‹å½“å‰è®¡ç®—æœºCPUä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># p_list = []</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># for i in range(12):  # ä¸€æ¬¡æ€§åˆ›å»º12ä¸ªè¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     p = Process(target=work)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     p.start()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     p_list.append(p)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># for p in p_list:  # ç¡®ä¿æ‰€æœ‰çš„è¿›ç¨‹å…¨éƒ¨è¿è¡Œå®Œæ¯•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     p.join()</span>
</span></span><span style="display:flex;"><span>    t_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">12</span>):
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> Thread(target<span style="color:#f92672">=</span>work)
</span></span><span style="display:flex;"><span>        t<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        t_list<span style="color:#f92672">.</span>append(t)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> t_list:
</span></span><span style="display:flex;"><span>        t<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;æ€»è€—æ—¶:</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time))  <span style="color:#75715e"># è·å–æ€»çš„è€—æ—¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">è®¡ç®—å¯†é›†å‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    å¤šè¿›ç¨‹:5.665567398071289
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    å¤šçº¿ç¨‹:30.233906745910645
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">work</span>():
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)   <span style="color:#75715e"># æ¨¡æ‹Ÿçº¯IOæ“ä½œ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># t_list = []</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># for i in range(100):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     t = Thread(target=work)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     t.start()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># for t in t_list:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     t.join()</span>
</span></span><span style="display:flex;"><span>    p_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> Process(target<span style="color:#f92672">=</span>work)
</span></span><span style="display:flex;"><span>        p<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> p_list:
</span></span><span style="display:flex;"><span>        p<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;æ€»è€—æ—¶:</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IOå¯†é›†å‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    å¤šçº¿ç¨‹:0.0149583816528320
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    å¤šè¿›ç¨‹:0.6402878761291504
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span></code></pre></div><ul>
<li>æ­»é”ç°è±¡</li>
</ul>
<blockquote>
<p>æ­»é”ç°è±¡éå¸¸çš„æœ‰æ„æ€ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬é¢è¯•çš„æ—¶å€™é¢è¯•å®˜éœ€è¦è®©æˆ‘ä»¬è§£é‡Šæ­»é”
é¢è¯•å®˜ï¼šè¯·ä½ è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯æ­»é”
å€™é€‰äººï¼šè®©æˆ‘è¿›å…¬å¸å°±å‘Šè¯‰ä½ 
é¢è¯•å®˜ï¼šé‚£ä½ å…ˆè§£é‡Šä»€ä¹ˆæ˜¯æ­»é”
å€™é€‰äººï¼šé‚£ä½ å…ˆè®©æˆ‘è¿›å…¬å¸æˆ‘å‘Šè¯‰ä½ å•Š
ä»¥ä¸Šä¾æ¬¡å¾€å¤ï¼Œè¿™å°±æ˜¯æ­»é”</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># ä»£ç å®ç°æ­»é”ç°è±¡</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> Thread,Lock
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mutexA <span style="color:#f92672">=</span> Lock()  <span style="color:#75715e"># äº§ç”Ÿä¸€æŠŠé”</span>
</span></span><span style="display:flex;"><span>mutexB <span style="color:#f92672">=</span> Lock()  <span style="color:#75715e"># äº§ç”Ÿä¸€æŠŠé”</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span>(Thread):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>func1()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>func2()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func1</span>(self):
</span></span><span style="display:flex;"><span>        mutexA<span style="color:#f92672">.</span>acquire()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">æŠ¢åˆ°äº†Aé”&#39;</span>)
</span></span><span style="display:flex;"><span>        mutexB<span style="color:#f92672">.</span>acquire()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">æŠ¢åˆ°äº†Bé”&#39;</span>)
</span></span><span style="display:flex;"><span>        mutexB<span style="color:#f92672">.</span>release()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">é‡Šæ”¾äº†Bé”&#39;</span>)
</span></span><span style="display:flex;"><span>        mutexA<span style="color:#f92672">.</span>release()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">é‡Šæ”¾äº†Aé”&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func2</span>(self):
</span></span><span style="display:flex;"><span>        mutexB<span style="color:#f92672">.</span>acquire()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">æŠ¢åˆ°äº†Bé”&#39;</span>)
</span></span><span style="display:flex;"><span>        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        mutexA<span style="color:#f92672">.</span>acquire()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">æŠ¢åˆ°äº†Aé”&#39;</span>)
</span></span><span style="display:flex;"><span>        mutexA<span style="color:#f92672">.</span>release()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">é‡Šæ”¾äº†Aé”&#39;</span>)
</span></span><span style="display:flex;"><span>        mutexB<span style="color:#f92672">.</span>release()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">é‡Šæ”¾äº†Bé”&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>):
</span></span><span style="display:flex;"><span>    obj <span style="color:#f92672">=</span> MyThread()
</span></span><span style="display:flex;"><span>    obj<span style="color:#f92672">.</span>start()
</span></span></code></pre></div><ul>
<li>ä¿¡å·é‡</li>
</ul>
<blockquote>
<p>ä¿¡å·é‡éœ€è¦ä½¿ç”¨Semaphoreï¼ŒåŒæ ·åœ¨threadingæ¨¡å—ä¸‹</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> Thread, Lock, Semaphore
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> randon
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sp <span style="color:#f92672">=</span> Semaphore(<span style="color:#ae81ff">5</span>)  <span style="color:#75715e"># ä¸€æ¬¡æ€§äº§ç”Ÿ5æŠŠé”</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span>(Thread):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self):
</span></span><span style="display:flex;"><span>		sp<span style="color:#f92672">.</span>acquire()
</span></span><span style="display:flex;"><span>		print(self<span style="color:#f92672">.</span>name)
</span></span><span style="display:flex;"><span>		time<span style="color:#f92672">.</span>sleep(random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>		sp<span style="color:#f92672">.</span>release()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">20</span>):
</span></span><span style="display:flex;"><span>	t <span style="color:#f92672">=</span> MyThread()
</span></span><span style="display:flex;"><span>	t<span style="color:#f92672">.</span>start()
</span></span></code></pre></div><ul>
<li>eventäº‹ä»¶</li>
</ul>
<blockquote>
<p>ç›¸å½“äºä¾èµ–ï¼ŒAçº¿ç¨‹å¿…é¡»ç­‰å¾…Bçº¿ç¨‹æ‰§è¡Œåˆ° event.set()ä½ç½®åå¹¶ä¸”è‡ªå·±æœ‰event.wait()åæ‰èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œ
ä½¿ç”¨çš„æ˜¯threadingä¸‹çš„Event</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> Thread, Event
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>event <span style="color:#f92672">=</span> Event()  <span style="color:#75715e"># ç±»ä¼¼äºé€ äº†ä¸€ä¸ªçº¢ç»¿ç¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">light</span>():
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;çº¢ç¯äº®ç€çš„ æ‰€æœ‰äººéƒ½ä¸èƒ½åŠ¨&#39;</span>)
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;ç»¿ç¯äº®äº† æ²¹é—¨è¸©åˆ°åº• ç»™æˆ‘å†²!!!&#39;</span>)
</span></span><span style="display:flex;"><span>    event<span style="color:#f92672">.</span>set()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">car</span>(name):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">æ­£åœ¨ç­‰çº¢ç¯&#39;</span> <span style="color:#f92672">%</span> name)
</span></span><span style="display:flex;"><span>    event<span style="color:#f92672">.</span>wait()
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">åŠ æ²¹é—¨ é£™è½¦äº†&#39;</span> <span style="color:#f92672">%</span> name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>t <span style="color:#f92672">=</span> Thread(target<span style="color:#f92672">=</span>light)
</span></span><span style="display:flex;"><span>t<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">20</span>):
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">=</span> Thread(target<span style="color:#f92672">=</span>car, args<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;ç†ŠçŒ«PRO</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> i,))
</span></span><span style="display:flex;"><span>    t<span style="color:#f92672">.</span>start()
</span></span></code></pre></div><ul>
<li>è¿›ç¨‹æ± ä¸çº¿ç¨‹æ± </li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>è¿›ç¨‹å’Œçº¿ç¨‹èƒ½å¦æ— é™åˆ¶çš„åˆ›å»º ä¸å¯ä»¥
</span></span><span style="display:flex;"><span>å› ä¸ºç¡¬ä»¶çš„å‘å±•èµ¶ä¸ä¸Šè½¯ä»¶ æœ‰ç‰©ç†æé™ å¦‚æœæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­æ— é™åˆ¶çš„åˆ›å»ºè¿›ç¨‹æˆ–è€…çº¿ç¨‹å¯èƒ½ä¼šå¯¼è‡´è®¡ç®—æœºå¥”æºƒ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>æ± 
</span></span><span style="display:flex;"><span>	é™ä½ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ ä½†æ˜¯ä¿è¯äº†è®¡ç®—æœºç¡¬ä»¶çš„å®‰å…¨
</span></span><span style="display:flex;"><span>è¿›ç¨‹æ± 
</span></span><span style="display:flex;"><span>	æå‰åˆ›å»ºå¥½å›ºå®šæ•°é‡çš„è¿›ç¨‹ä¾›åç»­ç¨‹åºçš„è°ƒç”¨ è¶…å‡ºåˆ™ç­‰å¾…
</span></span><span style="display:flex;"><span>çº¿ç¨‹æ± 
</span></span><span style="display:flex;"><span>	æå‰åˆ›å»ºå¥½å›ºå®šæ•°é‡çš„çº¿ç¨‹ä¾›åç»­ç¨‹åºçš„è°ƒç”¨ è¶…å‡ºåˆ™ç­‰å¾…
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> concurrent.futures <span style="color:#f92672">import</span> ProcessPoolExecutor, ThreadPoolExecutor
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> current_thread
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1.äº§ç”Ÿå«æœ‰å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ± </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pool = ThreadPoolExecutor(10)</span>
</span></span><span style="display:flex;"><span>pool <span style="color:#f92672">=</span> ProcessPoolExecutor(<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">task</span>(n):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;task is running&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># time.sleep(random.randint(1, 3))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># print(&#39;task is over&#39;, n, current_thread().name)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># print(&#39;task is over&#39;, os.getpid())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;æˆ‘æ˜¯taskå‡½æ•°çš„è¿”å›å€¼&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;from func&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 2.å°†ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± å³å¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">20</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># res = pool.submit(task, 123)  # æœçº¿ç¨‹æ± æäº¤ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print(res.result())  # ä¸èƒ½ç›´æ¥è·å–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># pool.submit(task, 123).add_done_callback(func)</span>
</span></span></code></pre></div><ul>
<li>åç¨‹</li>
</ul>
<blockquote>
<p>åç¨‹éœ€è¦ä½¿ç”¨çŒ´å­æ¨¡å—
threadingæ¨¡å—é€šè¿‡åº”ç”¨çº¿ç¨‹å®ç°å¹¶å‘ï¼Œmultiprocessingä½¿ç”¨è¿›ç¨‹å®ç°å¹¶å‘ã€‚åœ¨pythonä¸­ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§å®ç°å¹¶å‘çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯åç¨‹ä¸€ç§å•çº¿ç¨‹å•è¿›ç¨‹çš„æ–¹æ³•æ¥å®ç°å¹¶å‘</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">è¿›ç¨‹:èµ„æºå•ä½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">çº¿ç¨‹:æ‰§è¡Œå•ä½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">åç¨‹:å•çº¿ç¨‹ä¸‹å®ç°å¹¶å‘(æ•ˆç‡æé«˜)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	åœ¨ä»£ç å±‚é¢æ¬ºéª—CPU è®©CPUè§‰å¾—æˆ‘ä»¬çš„ä»£ç é‡Œé¢æ²¡æœ‰IOæ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	å®é™…ä¸ŠIOæ“ä½œè¢«æˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç æ£€æµ‹ ä¸€æ—¦æœ‰ ç«‹åˆ»è®©ä»£ç æ‰§è¡Œåˆ«çš„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	(è¯¥æŠ€æœ¯å®Œå…¨æ˜¯ç¨‹åºå‘˜è‡ªå·±å¼„å‡ºæ¥çš„ åå­—ä¹Ÿæ˜¯ç¨‹åºå‘˜è‡ªå·±èµ·çš„)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		æ ¸å¿ƒ:è‡ªå·±å†™ä»£ç å®Œæˆåˆ‡æ¢+ä¿å­˜çŠ¶æ€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gevent <span style="color:#f92672">import</span> monkey;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>monkey<span style="color:#f92672">.</span>patch_all()  <span style="color:#75715e"># å›ºå®šç¼–å†™ ç”¨äºæ£€æµ‹æ‰€æœ‰çš„IOæ“ä½œ(çŒ´å­è¡¥ä¸)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gevent <span style="color:#f92672">import</span> spawn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func1</span>():
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;func1 running&#39;</span>)
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;func1 over&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func2</span>():
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;func2 running&#39;</span>)
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;func2 over&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># func1()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># func2()</span>
</span></span><span style="display:flex;"><span>    s1 <span style="color:#f92672">=</span> spawn(func1)  <span style="color:#75715e"># æ£€æµ‹ä»£ç  ä¸€æ—¦æœ‰IOè‡ªåŠ¨åˆ‡æ¢(æ‰§è¡Œæ²¡æœ‰ioçš„æ“ä½œ å˜å‘çš„ç­‰å¾…ioç»“æŸ)</span>
</span></span><span style="display:flex;"><span>    s2 <span style="color:#f92672">=</span> spawn(func2)
</span></span><span style="display:flex;"><span>    s1<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>    s2<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>    print(time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time)  <span style="color:#75715e"># 8.01237154006958   åç¨‹ 5.015487432479858</span>
</span></span></code></pre></div><ul>
<li>åç¨‹å®ç°å¹¶å‘</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gevent <span style="color:#f92672">import</span> monkey;monkey<span style="color:#f92672">.</span>patch_all()  <span style="color:#75715e"># å›ºå®šç¼–å†™ ç”¨äºæ£€æµ‹æ‰€æœ‰çš„IOæ“ä½œ(çŒ´å­è¡¥ä¸)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gevent <span style="color:#f92672">import</span> spawn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">communication</span>(sock):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> sock<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>        print(data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf8&#39;</span>))
</span></span><span style="display:flex;"><span>        sock<span style="color:#f92672">.</span>send(data<span style="color:#f92672">.</span>upper())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_server</span>():
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket()
</span></span><span style="display:flex;"><span>    server<span style="color:#f92672">.</span>bind((<span style="color:#e6db74">&#39;127.0.0.1&#39;</span>, <span style="color:#ae81ff">8080</span>))
</span></span><span style="display:flex;"><span>    server<span style="color:#f92672">.</span>listen(<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        sock, addr <span style="color:#f92672">=</span> server<span style="color:#f92672">.</span>accept()  <span style="color:#75715e"># IOæ“ä½œ</span>
</span></span><span style="display:flex;"><span>        spawn(communication, sock)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s1 <span style="color:#f92672">=</span> spawn(get_server)
</span></span><span style="display:flex;"><span>s1<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>å¦‚ä½•ä¸æ–­çš„æå‡ç¨‹åºçš„è¿è¡Œæ•ˆç‡
</span></span><span style="display:flex;"><span>	å¤šè¿›ç¨‹ä¸‹å¼€å¤šçº¿ç¨‹ å¤šçº¿ç¨‹ä¸‹å¼€åç¨‹
</span></span></code></pre></div>
  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  self-salvation 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">All posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/python">Python</a></li>
         
        <li><a href="/databases">databases</a></li>
         
        <li><a href="/web">web</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
